---
title: "ERA-Interim/ASOS Wind Speed Comparison"
output: pdf_document
---

```{r setup, echo = FALSE, fig.height = 1.25, fig.width = 8, warning = FALSE, message = FALSE}
library(dplyr)
library(lubridate)
library(ggplot2)
library(tidyr)

knitr::opts_chunk$set(root.dir = "../")
# directories
workdir <- knitr::opts_chunk$get("root.dir")
datadir <- file.path(workdir, "data")
asos_adj_dir <- file.path(datadir, "AK_ASOS_stations_adj")
era_adj_dir <- file.path(datadir, "ERA_stations_adj")

era_adj_paths <- list.files(era_adj_dir, full.names = TRUE)
for(i in 1:5){
  era <- readRDS(era_adj_paths[i])
  stid <- era$stid[1]
  asos <- readRDS(file.path(asos_adj_dir, paste0(stid, ".Rds")))
  
  asos <- asos %>% 
    select(t_round, sped_adj) %>% 
    rename(ts = t_round, ASOS = sped_adj)

  df <- era %>% 
    dplyr::select(ts, sped_adj) %>%
    rename(ERA = sped_adj) %>%
    left_join(asos, by = "ts") %>%
    gather("Source", "sped", -ts) %>%
    mutate(M = ymd(paste0(format(ts, "%Y-%m"), "-01"))) %>%
    group_by(Source, M) %>%
    summarise(avg_sped_mo = mean(sped, na.rm = TRUE))
  
  p <- ggplot(df, aes(M, avg_sped_mo, color = Source)) + 
    geom_line() +
    xlab("") + ylab("Speed (mph)") +
    ggtitle(stid)
    
  print(p)
}


```

